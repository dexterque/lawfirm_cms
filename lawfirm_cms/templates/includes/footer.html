{% load static %}
<style>
    .inquiry-form {
        display: flex;
        width: 100%;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px 0;
    }

    .inquiry-form .form-input {
        height: 45px;
        border-radius: 5px;
        background: #ffffff;
        font-size: 16px;
        padding: 0 15px;
        border: none;
        outline: none;
        box-sizing: border-box;
    }

    .inquiry-form .form-input:focus {
        box-shadow: 0 0 0 2px rgba(187, 41, 36, 0.3);
    }

    .inquiry-form .input-name {
        flex: 0 0 180px;
    }

    .inquiry-form .input-phone {
        flex: 0 0 200px;
    }

    .inquiry-form .input-case {
        flex: 1 1 250px;
        min-width: 200px;
    }

    .inquiry-form .submit-btn {
        border: 0;
        height: 45px;
        padding: 0 30px;
        background: #bb2924;
        font-size: 16px;
        border-radius: 5px;
        color: #ffffff;
        cursor: pointer;
        transition: background 0.3s;
        white-space: nowrap;
    }

    .inquiry-form .submit-btn:hover {
        background: #9a1f1b;
    }

    .inquiry-form .submit-btn:disabled {
        background: #999;
        cursor: not-allowed;
    }

    #formMessage {
        width: 100%;
        text-align: center;
        padding: 12px;
        border-radius: 5px;
        margin-top: 10px;
    }

    /* 平板端适配 */
    @media (max-width: 992px) {
        .inquiry-form {
            padding: 15px;
        }

        .inquiry-form .input-name,
        .inquiry-form .input-phone {
            flex: 1 1 45%;
            min-width: 150px;
        }

        .inquiry-form .input-case {
            flex: 1 1 100%;
        }

        .inquiry-form .submit-btn {
            flex: 1 1 100%;
        }
    }

    /* 移动端适配 */
    @media (max-width: 768px) {
        .inquiry-form {
            flex-direction: column;
            padding: 20px 15px;
            gap: 12px;
        }

        .inquiry-form .form-input {
            width: 100% !important;
            flex: none !important;
            height: 48px;
            font-size: 15px;
        }

        .inquiry-form .submit-btn {
            width: 100%;
            height: 48px;
            font-size: 16px;
            margin-top: 5px;
        }
    }

    /* 小屏手机适配 */
    @media (max-width: 480px) {
        .inquiry-form {
            padding: 15px 10px;
        }

        .inquiry-form .form-input {
            font-size: 14px;
            padding: 0 12px;
        }

        .inquiry-form .form-input::placeholder {
            font-size: 14px;
        }
    }
</style>

<div class="footer">
    <div class="footer-nav w1400">
        <div class="index-container">
            <div class="nav-list">
                <a href="/jingdiananli/" title="经典案例">经典案例</a>
                <a href="/yewulingyu/" title="业务领域">业务领域</a>
                <a href="/zhuanyetuandui/" title="专业团队">专业团队</a>
                <a href="/xinwendongtai/" title="新闻动态">新闻动态</a>
                <a href="/guanyuwomen/" title="关于我们">关于我们</a>
            </div>
        </div>
    </div>
    <div class="w1400">
        <div class="message">
            <div class="banner_tips">
                <div class="container">
                    <div class="content">
                        <form id="caseInquiryForm" action="{% url 'submit_inquiry' %}" method="post">
                            {% csrf_token %}
                            <div class="inquiry-form">
                                <input class="form-input input-name" name="name" id="inquiry_name" type="text"
                                    placeholder="请输入您的姓名" required />
                                <input class="form-input input-phone" name="phone" id="inquiry_phone" type="tel"
                                    placeholder="请输入您的手机号码" pattern="1[3-9]\d{9}" maxlength="11" required />
                                <input class="form-input input-case" name="case_description" id="inquiry_case"
                                    type="text" placeholder="请输入您的大致案情" required />
                                <button type="submit" id="submitBtn" class="submit-btn">提交信息</button>
                            </div>
                            <div id="formMessage" style="display:none;"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="copyright w1400">
        <div class="index-container">
            <p>Copyright © 2012-2024 北京诚辩律师事务所 版权所有<a href="https://beian.miit.gov.cn/" rel="nofollow"
                    target="_blank">京ICP备15006976号-1</a></p>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // 手机号验证正则
        var phoneRegex = /^1[3-9]\d{9}$/;

        // 表单提交
        $('#caseInquiryForm').on('submit', function (e) {
            e.preventDefault();

            var $form = $(this);
            var $submitBtn = $('#submitBtn');
            var $message = $('#formMessage');

            // 获取表单数据
            var name = $('#inquiry_name').val().trim();
            var phone = $('#inquiry_phone').val().trim();
            var caseDesc = $('#inquiry_case').val().trim();

            // 前端验证
            if (!name) {
                showMessage('请输入您的姓名', 'error');
                return;
            }

            if (!phone) {
                showMessage('请输入您的手机号码', 'error');
                return;
            }

            if (!phoneRegex.test(phone)) {
                showMessage('请输入有效的11位手机号码', 'error');
                return;
            }

            if (!caseDesc) {
                showMessage('请输入您的案情描述', 'error');
                return;
            }

            // 禁用提交按钮
            $submitBtn.prop('disabled', true).text('提交中...');

            // AJAX提交
            $.ajax({
                url: $form.attr('action'),
                method: 'POST',
                data: {
                    name: name,
                    phone: phone,
                    case_description: caseDesc,
                    csrfmiddlewaretoken: $form.find('[name=csrfmiddlewaretoken]').val()
                },
                success: function (response) {
                    if (response.success) {
                        showMessage(response.message, 'success');
                        $form[0].reset();
                    } else {
                        var errorMsg = response.message || '提交失败，请重试';
                        if (response.errors) {
                            var errors = [];
                            for (var key in response.errors) {
                                errors.push(response.errors[key]);
                            }
                            errorMsg = errors.join('；');
                        }
                        showMessage(errorMsg, 'error');
                    }
                },
                error: function (xhr) {
                    var errorMsg = '提交失败，请稍后重试';
                    try {
                        var response = JSON.parse(xhr.responseText);
                        if (response.message) {
                            errorMsg = response.message;
                        }
                        if (response.errors) {
                            var errors = [];
                            for (var key in response.errors) {
                                errors.push(response.errors[key]);
                            }
                            errorMsg = errors.join('；');
                        }
                    } catch (e) { }
                    showMessage(errorMsg, 'error');
                },
                complete: function () {
                    $submitBtn.prop('disabled', false).text('提交信息');
                }
            });
        });

        // 显示消息
        function showMessage(msg, type) {
            var $message = $('#formMessage');

            if (type === 'success') {
                $message.css({
                    'background': '#d4edda',
                    'color': '#155724',
                    'border': '1px solid #c3e6cb'
                });
            } else {
                $message.css({
                    'background': '#f8d7da',
                    'color': '#721c24',
                    'border': '1px solid #f5c6cb'
                });
            }

            $message.text(msg).fadeIn();

            setTimeout(function () {
                $message.fadeOut();
            }, 5000);
        }

        // 手机号实时验证
        $('#inquiry_phone').on('blur', function () {
            var phone = $(this).val().trim();
            if (phone && !phoneRegex.test(phone)) {
                $(this).css('border', '2px solid #dc3545');
            } else {
                $(this).css('border', '1px solid #ccc');
            }
        });
    });
</script>